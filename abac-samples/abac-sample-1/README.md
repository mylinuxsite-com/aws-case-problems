
# Attribute-based Access Control (ABAC) Examples

## Example 1 - ABAC Using Tags.

### Summary
In this example, we will demonstrate ABAC using tags.

We will have two(2) roles: Role 1 and Role 2. Role 1 will assume Role 2, which has access to objects in an S3 bucket. Role 1 will be allowed to assume Role 2 if both have the same value in a particular tag, and Role 2 will be allowed to access objects in the S3 bucket if they have the same value of a specific tag.

### Demonstration

**1.** Deploy the application stack.

> cdk deploy

The stack will create three (3) resources, namely: (1) IAM role called ABACRole1, (2) IAM role ABACRole2 and (3) an S3 bucket with a name auto-generated by CloudFormation. The stack will also copy a file called "hello_world.txt" into the S3 bucket

**2.** Test if you can assume ABACRole1

> aws sts assume-role --role-arn arn:aws:iam::&lt;account id&gt;:role/ABACRole1 --role-session-name ABAC-Role-1 

This should fail.

*Note: The role that you used to deploy the CDK above will be a trusted principal in ABACRole1. This should allow you to assume this role from the role that created the stack.*

**3** Re-run the stack using the step_1 context.

> cdk deploy --context step_no=step_1

**4** Retry **#2**

This should succeed.

**5** Copy a file from S3 as ABACRole2 

> aws s3 cp s3://abacsample1stack-bucketxxxxx-yyyyyyyy/hello_world.txt /tmp

This should fail.

**6** Re-run the stack using the step_2 context.

> cdk deploy --context step_no=step_2

**7** Retry **#5**

This should succeed.